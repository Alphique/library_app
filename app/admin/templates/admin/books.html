{% extends "base.html" %}

{% block content %}
<div class="bg-system">
    <div class="bg-image" style="background-image: url('{{ url_for('static', filename='photos/cuzlib.png') }}');"></div>
    <div class="bg-overlay-glass"></div>
</div>

<div class="container-fluid py-4 dashboard-relative">
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h1 class="text-white fw-bold mb-0">
                <i class="fas fa-book-reader text-gold me-2"></i>Manage <span class="text-gold-gradient">Archive</span>
            </h1>
            <p class="text-white-50 small mb-0">Librarian Oversight & Collection Control</p>
        </div>
        <div class="col-md-6 text-md-end mt-3 mt-md-0">
            <div class="glass-stat-badge">
                <span class="text-white-50 me-2">Total Volume:</span>
                <span class="text-gold fw-bold fs-5">{{ books.total }}</span>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-12">
            <div class="content-glass-card p-4">
                <form method="GET" action="{{ url_for('admin.books') }}" class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label class="text-white-50 small text-uppercase mb-2">Title Keywords</label>
                        {{ form.title(class="glass-input form-control", value=request.args.get('title', ''), placeholder="Enter title...") }}
                    </div>
                    <div class="col-md-3">
                        <label class="text-white-50 small text-uppercase mb-2">Author Name</label>
                        {{ form.author(class="glass-input form-control", value=request.args.get('author', ''), placeholder="Enter author...") }}
                    </div>
                    <div class="col-md-2">
                        <label class="text-white-50 small text-uppercase mb-2">Category</label>
                        {{ form.category(class="glass-input form-select", value=request.args.get('category', '')) }}
                    </div>
                    <div class="col-md-2">
                        <label class="text-white-50 small text-uppercase mb-2">Status</label>
                        {{ form.status(class="glass-input form-select", value=request.args.get('status', '')) }}
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn-gold-action w-100">
                            <i class="fas fa-search me-2"></i>Filter
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="content-glass-card overflow-hidden">
                <div class="table-responsive">
                    <table class="table table-dark-glass align-middle mb-0">
                        <thead>
                            <tr>
                                <th class="ps-4">Resource</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Financials</th>
                                <th>Meta Data</th>
                                <th class="text-end pe-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for book in books.items %}
                            <tr class="glass-row">
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="book-icon-box me-3">
                                            <i class="fas fa-book"></i>
                                        </div>
                                        <div>
                                            <div class="text-white fw-bold mb-0">{{ book.title }}</div>
                                            <div class="text-white-50 small">{{ book.author }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge-glass-outline">
                                        {{ book.category|replace('-', ' ')|title }}
                                    </span>
                                </td>
                                <td>
                                    {% if book.status == 'available' %}
                                        <span class="status-indicator available">Available</span>
                                    {% else %}
                                        <span class="status-indicator rented">Rented</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="small text-white-50">Price: <span class="text-white">${{ "%.2f"|format(book.price) }}</span></div>
                                    <div class="small text-white-50">Rent: <span class="text-gold">${{ "%.2f"|format(book.rental_fee) }}/day</span></div>
                                </td>
                                <td>
                                    <div class="small text-white-50"><i class="fas fa-user-edit me-1"></i> {{ book.uploader.username }}</div>
                                    <div class="small text-white-50"><i class="fas fa-calendar-alt me-1"></i> {{ book.created_at.strftime('%Y-%m-%d') }}</div>
                                </td>
                                <td class="text-end pe-4">
                                    <div class="btn-group">
                                        <a href="{{ url_for('books.book_detail', book_id=book.book_id) }}" class="btn btn-sm btn-glass-action" title="View Detail">
                                            <i class="fas fa-eye text-info"></i>
                                        </a>
                                        <a href="{{ url_for('admin.delete_book', book_id=book.book_id) }}" 
                                           class="btn btn-sm btn-glass-action" 
                                           onclick="return confirm('Archive permanently?')">
                                            <i class="fas fa-trash-alt text-danger"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% if books.pages > 1 %}
    <div class="mt-4">
        <nav>
            <ul class="pagination-glass justify-content-center">
                {% if books.has_prev %}
                <li><a href="{{ url_for('admin.books', page=books.prev_num) }}"><i class="fas fa-chevron-left"></i></a></li>
                {% endif %}
                
                {% for page_num in books.iter_pages() %}
                    {% if page_num %}
                        <li class="{{ 'active' if books.page == page_num else '' }}">
                            <a href="{{ url_for('admin.books', page=page_num) }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="disabled"><span>...</span></li>
                    {% endif %}
                {% endfor %}

                {% if books.has_next %}
                <li><a href="{{ url_for('admin.books', page=books.next_num) }}"><i class="fas fa-chevron-right"></i></a></li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>

<style>
    /* CORE THEME */
    :root {
        --glass-bg: rgba(10, 15, 30, 0.7);
        --glass-border: rgba(255, 255, 255, 0.1);
        --gold: #d4af37;
    }

    /* Fixed Background */
    .bg-system { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; }
    .bg-image { width: 100%; height: 100%; background-size: cover; background-position: center; filter: brightness(0.3); }
    .bg-overlay-glass { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, transparent 0%, rgba(2, 6, 23, 0.95) 100%); }
    .dashboard-relative { position: relative; z-index: 10; }

    /* Glass Cards */
    .content-glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--glass-border);
        border-radius: 15px;
    }

    .glass-stat-badge {
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid var(--gold);
        padding: 10px 20px;
        border-radius: 50px;
        display: inline-block;
    }

    /* Table Design */
    .table-dark-glass { color: white; border-collapse: separate; border-spacing: 0 5px; }
    .table-dark-glass thead th {
        background: rgba(255,255,255,0.05);
        border: none;
        color: var(--gold);
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 1px;
        padding: 15px;
    }
    .glass-row { transition: 0.3s; }
    .glass-row:hover { background: rgba(255,255,255,0.05); }
    
    .book-icon-box {
        width: 40px;
        height: 40px;
        background: rgba(212, 175, 55, 0.15);
        color: var(--gold);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        border: 1px solid rgba(212, 175, 55, 0.3);
    }

    /* Status Indicators */
    .status-indicator {
        font-size: 0.7rem;
        padding: 4px 10px;
        border-radius: 20px;
        font-weight: bold;
        text-transform: uppercase;
    }
    .status-indicator.available { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }
    .status-indicator.rented { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid #f59e0b; }

    /* Inputs & Buttons */
    .glass-input {
        background: rgba(255, 255, 255, 0.05) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        color: white !important;
        border-radius: 8px;
    }
    .glass-input:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }

    .btn-gold-action {
        background: linear-gradient(135deg, var(--gold), #b8860b);
        color: black;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        padding: 8px 15px;
        transition: 0.3s;
    }
    .btn-gold-action:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }

    .btn-glass-action {
        background: rgba(255,255,255,0.05);
        border: 1px solid var(--glass-border);
        color: white;
        margin-left: 5px;
    }
    .btn-glass-action:hover { background: rgba(255,255,255,0.15); }

    /* Pagination */
    .pagination-glass { display: flex; list-style: none; padding: 0; gap: 5px; }
    .pagination-glass a, .pagination-glass span {
        padding: 8px 16px;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        transition: 0.3s;
    }
    .pagination-glass li.active a { background: var(--gold); color: black; border-color: var(--gold); }
    .pagination-glass a:hover:not(.active) { background: rgba(255,255,255,0.1); }

    .badge-glass-outline {
        border: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 3px 10px;
        border-radius: 5px;
        font-size: 0.75rem;
    }
    .text-gold-gradient {
        background: linear-gradient(to right, #fff, var(--gold));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>
{% endblock %}