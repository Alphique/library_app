<!-- app/templates/payments/wallet.html -->
{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üí∞ My Wallet</h4>
            </div>
            <div class="card-body">
                <!-- Current Balance -->
                <div class="row text-center mb-4">
                    <div class="col-12">
                        <h3 class="text-muted">Current Balance</h3>
                        <h1 class="display-4 text-success">${{ "%.2f"|format(current_user.wallet.balance) }}</h1>
                        <p class="text-muted">Last updated: {{ current_user.wallet.updated_at.strftime('%B %d, %Y at %H:%M') }}</p>
                    </div>
                </div>

                <!-- Add Funds Form -->
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üí≥ Add Funds</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="">
                            {{ form.hidden_tag() }}
                            <div class="row align-items-end">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.amount.label(class="form-label") }}
                                        {% if form.amount.errors %}
                                            {{ form.amount(class="form-control is-invalid", type="number", step="0.01", min="1", max="1000") }}
                                            <div class="invalid-feedback">
                                                {% for error in form.amount.errors %}
                                                    <span>{{ error }}</span>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{ form.amount(class="form-control", type="number", step="0.01", min="1", max="1000", placeholder="Enter amount") }}
                                        {% endif %}
                                        <div class="form-text">Enter amount between $1 and $1000</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-grid">
                                        {{ form.submit(class="btn btn-success btn-lg") }}
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Quick Add Buttons -->
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0">‚ö° Quick Add</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-3 mb-2">
                                <form method="POST" action="" style="display: inline;">
                                    {{ form.hidden_tag() }}
                                    <input type="hidden" name="amount" value="10">
                                    <button type="submit" class="btn btn-outline-primary w-100">+$10</button>
                                </form>
                            </div>
                            <div class="col-3 mb-2">
                                <form method="POST" action="" style="display: inline;">
                                    {{ form.hidden_tag() }}
                                    <input type="hidden" name="amount" value="25">
                                    <button type="submit" class="btn btn-outline-primary w-100">+$25</button>
                                </form>
                            </div>
                            <div class="col-3 mb-2">
                                <form method="POST" action="" style="display: inline;">
                                    {{ form.hidden_tag() }}
                                    <input type="hidden" name="amount" value="50">
                                    <button type="submit" class="btn btn-outline-primary w-100">+$50</button>
                                </form>
                            </div>
                            <div class="col-3 mb-2">
                                <form method="POST" action="" style="display: inline;">
                                    {{ form.hidden_tag() }}
                                    <input type="hidden" name="amount" value="100">
                                    <button type="submit" class="btn btn-outline-primary w-100">+$100</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <!-- Wallet Info -->
        <div class="card">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0">‚ÑπÔ∏è Wallet Information</h5>
            </div>
            <div class="card-body">
                <h6>How it works:</h6>
                <ul class="small">
                    <li>Add funds to your wallet using the form</li>
                    <li>Use wallet balance to rent or purchase books</li>
                    <li>Earn money when others rent or buy your books</li>
                    <li>All transactions are secure and instant</li>
                </ul>
                
                <h6 class="mt-3">Quick Stats:</h6>
                <div class="row text-center">
                    <div class="col-6">
                        <div class="border rounded p-2 mb-2">
                            <small class="text-muted">Books Uploaded</small>
                            <div><strong>{{ current_user.books.count() }}</strong></div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-2 mb-2">
                            <small class="text-muted">Total Earnings</small>
                            <div><strong>${{ "%.2f"|format(total_earnings) }}</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="card mt-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">üìä Recent Activity</h6>
            </div>
            <div class="card-body">
                {% if recent_transactions %}
                    {% for transaction in recent_transactions %}
                    <div class="d-flex justify-content-between align-items-center mb-2 pb-2 border-bottom">
                        <div>
                            <small class="text-muted">{{ transaction.created_at.strftime('%m/%d') }}</small>
                            <br>
                            <small><strong>{{ transaction.transaction_type|title }}</strong></small>
                        </div>
                        <div class="text-end">
                            <span class="text-{{ 'success' if transaction.amount > 0 else 'danger' }}">
                                {{ '+' if transaction.amount > 0 else '' }}${{ "%.2f"|format(transaction.amount) }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="text-center mt-2">
                        <a href="{{ url_for('payments.transaction_history') }}" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                {% else %}
                    <p class="text-muted text-center mb-0">No recent transactions</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}